#!/usr/bin/env sh

echo "ğŸ” Verificando se precisa incrementar versÃ£o antes do push..."

# Verifica se estÃ¡ na branch main
current_branch=$(git branch --show-current)

if [ "$current_branch" = "main" ]; then
  echo "ğŸ“¦ Executando auto-versionamento na branch main..."
  
  # Executa o bump da versÃ£o
  dart tool/auto_version.dart
  
  if [ $? -eq 0 ]; then
    echo "âœ… Versionamento automÃ¡tico concluÃ­do"
    
    # Adiciona os arquivos modificados e amenda ao Ãºltimo commit
    git add pubspec.yaml lib/src/version.dart
    git commit --amend --no-edit
    
    echo "ğŸš€ VersÃ£o adicionada ao Ãºltimo commit, prosseguindo com push..."
  else
    echo "âŒ Erro no versionamento automÃ¡tico"
    exit 1
  fi
else
  echo "âš ï¸  Pulando auto-versionamento (nÃ£o estÃ¡ na branch main)"
fi 