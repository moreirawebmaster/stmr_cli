#!/usr/bin/env sh

echo "üîç Verificando se precisa incrementar vers√£o antes do push..."

# Verifica se est√° na branch main
current_branch=$(git branch --show-current)

if [ "$current_branch" = "main" ]; then
  echo "üì¶ Executando auto-versionamento na branch main..."
  
  # Executa o bump da vers√£o
  dart tool/auto_version.dart
  
  if [ $? -eq 0 ]; then
    echo "‚úÖ Versionamento autom√°tico conclu√≠do"
    
    # Pega a nova vers√£o do pubspec.yaml
    new_version=$(grep "version:" pubspec.yaml | sed 's/version: //')
    
    # Adiciona os arquivos modificados e amenda ao √∫ltimo commit
    git add pubspec.yaml lib/src/version.dart
    git commit --amend --no-edit
    
    echo "üöÄ Vers√£o $new_version adicionada ao √∫ltimo commit, prosseguindo com push..."
    
    # Ap√≥s o push ser bem-sucedido, executa post-push actions
    # Nota: Este hook executa ANTES do push, ent√£o criaremos um script separado
    
  else
    echo "‚ùå Erro no versionamento autom√°tico"
    exit 1
  fi
else
  echo "‚ö†Ô∏è  Pulando auto-versionamento (n√£o est√° na branch main)"
fi 